---
import { cn } from '@lib/utils';

interface Props {
  value: number;
  label?: string;
  color?: 'primary' | 'success' | 'warning' | 'error';
  class?: string;
}

const {
  value,
  label,
  color = 'primary',
  class: className
} = Astro.props;

const colors = {
  primary: 'bg-primary-600 dark:bg-primary-500',
  success: 'bg-green-600 dark:bg-green-500',
  warning: 'bg-yellow-600 dark:bg-yellow-500',
  error: 'bg-red-600 dark:bg-red-500',
};
---

<div class={cn('progress-bar-wrapper', className)}>
  {label && (
    <div class="flex justify-between items-center mb-2">
      <span class="text-sm font-medium text-neutral-900 dark:text-white">
        {label}
      </span>
      <span class="text-sm font-medium text-neutral-600 dark:text-neutral-400">
        {value}%
      </span>
    </div>
  )}
  <div class="w-full h-3 bg-neutral-200 dark:bg-neutral-800 rounded-full overflow-hidden">
    <div
      class={cn('progress-bar-fill h-full transition-all duration-1000 ease-out', colors[color])}
      data-value={value}
      style="width: 0%"
    >
    </div>
  </div>
</div>

<script is:inline>
  function initProgressBars() {
    const bars = document.querySelectorAll('.progress-bar-fill');

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && !entry.target.dataset.animated) {
          const value = entry.target.dataset.value;
          setTimeout(() => {
            entry.target.style.width = `${value}%`;
          }, 100);
          entry.target.dataset.animated = 'true';
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.5 });

    bars.forEach(bar => observer.observe(bar));
  }

  initProgressBars();
  document.addEventListener('astro:page-load', initProgressBars);
</script>
