---
import { cn } from '@lib/utils';

interface Props {
  url: string;
  title: string;
  aspectRatio?: '16:9' | '4:3';
  class?: string;
}

const { url, title, aspectRatio = '16:9', class: className } = Astro.props;

const getEmbedUrl = (url: string): string => {
  if (url.includes('youtube.com') || url.includes('youtu.be')) {
    const videoId = url.includes('youtu.be')
      ? url.split('youtu.be/')[1]?.split('?')[0]
      : url.split('v=')[1]?.split('&')[0];
    return `https://www.youtube-nocookie.com/embed/${videoId}`;
  }

  if (url.includes('vimeo.com')) {
    const videoId = url.split('vimeo.com/')[1]?.split('?')[0];
    return `https://player.vimeo.com/video/${videoId}`;
  }

  return url;
};

const embedUrl = getEmbedUrl(url);
const paddingBottom = aspectRatio === '16:9' ? '56.25%' : '75%';
---

<div class={cn('video-embed-wrapper', className)}>
  <div class="relative overflow-hidden rounded-xl shadow-sm" style={`padding-bottom: ${paddingBottom}`}>
    <iframe
      src={embedUrl}
      title={title}
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen
      loading="lazy"
      class="absolute top-0 left-0 w-full h-full border-0"
    ></iframe>
  </div>
</div>
