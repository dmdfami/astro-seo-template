---
import { cn } from '@lib/utils';

interface Props {
  animation?: 'fade-up' | 'fade-down' | 'scale';
  delay?: number;
  class?: string;
}

const {
  animation = 'fade-up',
  delay = 0,
  class: className
} = Astro.props;

const animations = {
  'fade-up': 'opacity-0 translate-y-8',
  'fade-down': 'opacity-0 -translate-y-8',
  'scale': 'opacity-0 scale-95',
};
---

<div
  class={cn('scroll-reveal transition-all duration-700 ease-out', animations[animation], className)}
  style={delay ? `transition-delay: ${delay}ms` : ''}
>
  <slot />
</div>

<script is:inline>
  function initScrollReveal() {
    const elements = document.querySelectorAll('.scroll-reveal');

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting && !entry.target.dataset.revealed) {
          entry.target.classList.remove('opacity-0', 'translate-y-8', '-translate-y-8', 'scale-95');
          entry.target.classList.add('opacity-100', 'translate-y-0', 'scale-100');
          entry.target.dataset.revealed = 'true';
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });

    elements.forEach((el) => observer.observe(el));
  }

  initScrollReveal();
  document.addEventListener('astro:page-load', initScrollReveal);
</script>
