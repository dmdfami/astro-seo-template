---
import { cn } from '@lib/utils';
import Button from '../ui/Button.astro';
import Badge from '../ui/Badge.astro';

interface PricingPlan {
  name: string;
  price: string;
  features: string[];
  cta: { text: string; url: string };
  featured?: boolean;
}

interface Props {
  plans: PricingPlan[];
  toggle?: boolean;
}

const { plans, toggle = false } = Astro.props;
---

<div class="pricing-container">
  {toggle && (
    <div class="flex items-center justify-center gap-4 mb-8">
      <span class="text-sm font-medium text-neutral-600">Monthly</span>
      <button
        type="button"
        class="pricing-toggle relative inline-flex h-6 w-11 items-center rounded-full bg-neutral-200 transition-all duration-300 hover:shadow-md"
        role="switch"
        aria-checked="false"
      >
        <span class="pricing-toggle-dot inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1"></span>
      </button>
      <span class="text-sm font-medium text-neutral-900">Annual (Save 20%)</span>
    </div>
  )}

  <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
    {plans.map((plan) => (
      <div
        class={cn(
          'bg-white border rounded-xl p-8 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300',
          plan.featured
            ? 'border-primary-600 ring-2 ring-primary-600 scale-105'
            : 'border-neutral-200 hover:border-primary-300'
        )}
      >
        {plan.featured && (
          <Badge variant="success" class="mb-4">Most Popular</Badge>
        )}
        <h3 class="text-2xl font-bold text-neutral-900 mb-2">
          {plan.name}
        </h3>
        <div class="mb-6">
          <span class="text-4xl font-bold text-neutral-900">{plan.price}</span>
          <span class="text-neutral-600">/month</span>
        </div>
        <ul class="space-y-3 mb-8">
          {plan.features.map((feature) => (
            <li class="flex items-start gap-3">
              <svg class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <span class="text-neutral-600">{feature}</span>
            </li>
          ))}
        </ul>
        <Button href={plan.cta.url} variant={plan.featured ? 'primary' : 'outline'} class="w-full">
          {plan.cta.text}
        </Button>
      </div>
    ))}
  </div>
</div>

<script is:inline>
  function initPricing() {
    const toggle = document.querySelector('.pricing-toggle');
    if (!toggle) return;

    toggle.addEventListener('click', () => {
      const isAnnual = toggle.getAttribute('aria-checked') === 'true';
      toggle.setAttribute('aria-checked', !isAnnual);
      const dot = toggle.querySelector('.pricing-toggle-dot');

      if (!isAnnual) {
        dot.classList.add('translate-x-6');
        toggle.classList.add('bg-primary-600');
        toggle.classList.remove('bg-neutral-200');
      } else {
        dot.classList.remove('translate-x-6');
        toggle.classList.remove('bg-primary-600');
        toggle.classList.add('bg-neutral-200');
      }
    });
  }

  initPricing();
  document.addEventListener('astro:page-load', initPricing);
</script>
